<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTS_ARIRANG_TOUR</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- [CSS] „Éá„Ç∂„Ç§„É≥ÈÉ®ÂìÅ --- */
        :root { --main-red: #e63946; --bg-gray: #f8f9fa; --text-dark: #2b2d42; --white: #ffffff; }
        body { background: var(--bg-gray); color: var(--text-dark); font-family: 'Noto Sans JP', sans-serif; padding: 20px; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .header { font-family: 'Montserrat', sans-serif; color: var(--main-red); letter-spacing: 2px; text-align: center; }
        .card { background: var(--white); width: 100%; max-width: 400px; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border-top: 6px solid var(--main-red); margin-bottom: 15px; box-sizing: border-box; }
        label { font-size: 0.7rem; font-weight: 700; color: #8d99ae; display: block; margin-top: 10px; }
        input, select, textarea { width: 100%; font-size: 1rem; border: none; border-bottom: 2px solid #edf2f4; padding: 8px 0; outline: none; box-sizing: border-box; font-family: inherit; }
        button { background: var(--main-red); color: white; border: none; padding: 14px; border-radius: 12px; width: 100%; margin-top: 10px; font-weight: 700; font-size: 0.9rem; cursor: pointer; }
        .sec-btn { background: #edf2f4; color: var(--text-dark); }
        .del-btn { background: #f1f1f1; color: #cc0000; font-size: 0.7rem; width: auto; padding: 5px 10px; margin-top: 5px; }
        .view { display: none; width: 100%; max-width: 400px; }
        .active { display: block; }
        .preview-box { background: #fff1f2; padding: 10px; border-radius: 10px; margin-top: 10px; border: 1px dashed var(--main-red); text-align: center; }
        .history-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 5px solid var(--main-red); font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="mainView" class="view active">
        <div style="display:flex; justify-content:space-between;">
            <div id="lvlDisplay" class="lvl" style="background:var(--main-red); color:white; padding:2px 10px; border-radius:10px; font-size:0.8rem;">LV.1</div>
            <span onclick="show('setView')">‚öôÔ∏è Settings</span>
        </div>
        <h2 class="header">BTS_ARIRANG_TOUR</h2>
        
        <div class="card">
            <label>User Name</label>
            <input type="text" id="userName" placeholder="Your Name" onchange="saveUserName()">
            
            <label>Target Date</label>
            <input type="date" id="dateIn">
            
            <label>Start Time</label>
            <input type="time" id="timeIn">

            <label>Waiting People</label>
            <input type="number" id="countIn" class="big-input" style="font-size:2rem; text-align:center; color:var(--main-red);" placeholder="0" oninput="calcPreview()">
            
            <div id="preview" class="preview-box">
                <span style="font-size:0.8rem; color:#666;">‰∫àÊ∏¨ÂæÖ„Å°ÊôÇÈñì</span><br>
                <b id="preMin">0</b> min (ÂÖ•ÂÆ§‰∫àÂÆö: <b id="preEta">--:--</b>)
            </div>

            <button onclick="saveLog(true)">SUCCESS</button>
            <button onclick="saveLog(false)" style="background:#8d99ae;">FAILED</button>
        </div>
        <button class="sec-btn" onclick="show('histView')">VIEW HISTORY LOG</button>
    </div>

    <div id="histView" class="view">
        <h2 class="header">History Log</h2>
        <div id="logList"></div>
        <button class="sec-btn" onclick="show('mainView')">BACK</button>
    </div>

    <div id="setView" class="view">
        <h2 class="header">Settings</h2>
        <div class="card">
            <label>Speed (People per Hour)</label>
            <input type="number" id="speedSet" value="70">
            <button onclick="saveSpeed()">SAVE SPEED</button>
        </div>
        <button class="sec-btn" onclick="show('mainView')">BACK</button>
    </div>

    <script>
        /* --- [JS] ÂÖ±ÈÄö„Éá„Éº„ÇøÁÆ°ÁêÜ --- */
        let logs = JSON.parse(localStorage.getItem('arirang_logs') || '[]');
        let speed = localStorage.getItem('arirang_speed') || 70;
        let user = localStorage.getItem('arirang_user') || 'Army';

        function init() {
            const now = new Date();
            document.getElementById('dateIn').value = now.toISOString().split('T')[0];
            document.getElementById('timeIn').value = now.toTimeString().slice(0,5);
            document.getElementById('speedSet').value = speed;
            document.getElementById('userName').value = user;
            updateLevel();
        }

        /* --- [JS] Ë®àÁÆó„É≠„Ç∏„ÉÉ„ÇØ --- */
        function calcPreview() {
            const count = document.getElementById('countIn').value;
            if(!count) return;
            const mins = Math.ceil(count / (speed / 60));
            const now = new Date();
            const eta = new Date(now.getTime() + mins * 60000);
            
            document.getElementById('preMin').innerText = mins;
            document.getElementById('preEta').innerText = eta.toTimeString().slice(0,5);
            return { mins, eta: eta.toTimeString().slice(0,5) };
        }

        /* --- [JS] ÁîªÈù¢Âàá„ÇäÊõø„Åà --- */
        function show(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'histView') renderLogs();
        }

        /* --- [JS] ‰øùÂ≠ò„ÉªÂâäÈô§„É≠„Ç∏„ÉÉ„ÇØ --- */
        function saveLog(isSuccess) {
            const count = document.getElementById('countIn').value;
            if(!count) return alert("‰∫∫Êï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ");

            const pre = calcPreview();
            const memo = prompt("„É°„É¢„Åå„ÅÇ„Çå„Å∞ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰ªªÊÑèÔºâ");

            const newLog = {
                id: Date.now(),
                user: user,
                date: document.getElementById('dateIn').value,
                count: count,
                start: document.getElementById('timeIn').value,
                eta: pre.eta,
                success: isSuccess,
                memo: memo || ""
            };

            logs.push(newLog);
            localStorage.setItem('arirang_logs', JSON.stringify(logs));
            alert("Magic Recorded! ‚ú®");
            location.reload();
        }

        function deleteLog(id) {
            if(!confirm("„Åì„ÅÆÂ±•Ê≠¥„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) return;
            logs = logs.filter(l => l.id !== id);
            localStorage.setItem('arirang_logs', JSON.stringify(logs));
            renderLogs();
            updateLevel();
        }

        function saveSpeed() {
            speed = document.getElementById('speedSet').value;
            localStorage.setItem('arirang_speed', speed);
            show('mainView');
        }

        function saveUserName() {
            user = document.getElementById('userName').value;
            localStorage.setItem('arirang_user', user);
        }

        function renderLogs() {
            const list = document.getElementById('logList');
            list.innerHTML = logs.slice().reverse().map(l => `
                <div class="history-card">
                    <b>${l.date} | ${l.user}</b><br>
                    ‰∫∫Êï∞: ${l.count}‰∫∫ | ÈñãÂßã: ${l.start} | ÂÖ•ÂÆ§ÁõÆÂÆâ: ${l.eta}<br>
                    ÁµêÊûú: ${l.success ? '‚úÖSuccess' : '‚ùåFailed'}<br>
                    ${l.memo ? `<span style="color:#666;">üìù ${l.memo}</span><br>` : ''}
                    <button class="del-btn" onclick="deleteLog(${l.id})">Â±•Ê≠¥„ÇíÂâäÈô§</button>
                </div>
            `).join('');
        }

        function updateLevel() {
            const lv = Math.floor(logs.length / 3) + 1;
            document.getElementById('lvlDisplay').innerText = `LV.${lv}`;
        }

        init();
    </script>
</body>
</html>
